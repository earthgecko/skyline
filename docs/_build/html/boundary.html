

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Boundary &mdash; Skyline 1.1.9-beta documentation</title>
  

  
  

  

  
  
    

  

  
  
    <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  

  
    <link rel="stylesheet" href="_static/skyline.styles.css" type="text/css" />
  

  
        <link rel="index" title="Index"
              href="genindex.html"/>
        <link rel="search" title="Search" href="search.html"/>
    <link rel="top" title="Skyline 1.1.9-beta documentation" href="index.html"/>
        <link rel="next" title="Crucible" href="crucible.html"/>
        <link rel="prev" title="Mirage" href="mirage.html"/> 

  
  <script src="_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="index.html" class="icon icon-home"> Skyline
          

          
          </a>

          
            
            
              <div class="version">
                1.1
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
                <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="overview.html">Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="requirements.html">Requirements</a></li>
<li class="toctree-l1"><a class="reference internal" href="getting-started.html">Getting started</a></li>
<li class="toctree-l1"><a class="reference internal" href="running-in-python-virtualenv.html">Running Skyline in a Python virtualenv</a></li>
<li class="toctree-l1"><a class="reference internal" href="installation.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="upgrading/index.html">Upgrading</a></li>
<li class="toctree-l1"><a class="reference internal" href="getting-data-into-skyline.html">Getting data into Skyline</a></li>
<li class="toctree-l1"><a class="reference internal" href="alert-testing.html">Alert testing</a></li>
<li class="toctree-l1"><a class="reference internal" href="monotonic-metrics.html">Strictly increasing monotonicity</a></li>
<li class="toctree-l1"><a class="reference internal" href="horizon.html">Horizon</a></li>
<li class="toctree-l1"><a class="reference internal" href="analyzer.html">Analyzer</a></li>
<li class="toctree-l1"><a class="reference internal" href="analyzer-optimizations.html">Analyzer Optimizations</a></li>
<li class="toctree-l1"><a class="reference internal" href="mirage.html">Mirage</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Boundary</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#configuration-and-running-boundary">Configuration and running Boundary</a></li>
<li class="toctree-l2"><a class="reference internal" href="#detect-drop-off-cliff-algorithm">detect_drop_off_cliff algorithm</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#what-boundary-does">What <strong>Boundary</strong> does</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="crucible.html">Crucible</a></li>
<li class="toctree-l1"><a class="reference internal" href="panorama.html">Panorama</a></li>
<li class="toctree-l1"><a class="reference internal" href="webapp.html">Webapp</a></li>
<li class="toctree-l1"><a class="reference internal" href="ionosphere.html">Ionosphere</a></li>
<li class="toctree-l1"><a class="reference internal" href="tsfresh.html">tsfresh</a></li>
<li class="toctree-l1"><a class="reference internal" href="redis-integration.html">Redis integration</a></li>
<li class="toctree-l1"><a class="reference internal" href="skyline-and-friends.html">Skyline and friends</a></li>
<li class="toctree-l1"><a class="reference internal" href="logging.html">Logging</a></li>
<li class="toctree-l1"><a class="reference internal" href="tuning-tips.html">Tuning tips</a></li>
<li class="toctree-l1"><a class="reference internal" href="tuning-tips.html#smaller-deployments">Smaller deployments</a></li>
<li class="toctree-l1"><a class="reference internal" href="tuning-tips.html#reliability">Reliability</a></li>
<li class="toctree-l1"><a class="reference internal" href="monitoring-skyline.html">Monitoring Skyline</a></li>
<li class="toctree-l1"><a class="reference internal" href="debian-and-vagrant-installation-tips.html">Debian and Vagrant Installation Tips</a></li>
<li class="toctree-l1"><a class="reference internal" href="releases.html">Release Notes</a></li>
<li class="toctree-l1"><a class="reference internal" href="whats-new.html">What&#8217;s new</a></li>
<li class="toctree-l1"><a class="reference internal" href="development/index.html">Development</a></li>
<li class="toctree-l1"><a class="reference internal" href="roadmap.html">Roadmap</a></li>
<li class="toctree-l1"><a class="reference internal" href="skyline.html">skyline package</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="index.html">Skyline</a>
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          

 



<div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="index.html">Docs</a> &raquo;</li>
      
    <li>Boundary</li>
      <li class="wy-breadcrumbs-aside">
        
          
            <a href="_sources/boundary.txt" rel="nofollow"> View page source</a>
          
        
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="boundary">
<h1>Boundary<a class="headerlink" href="#boundary" title="Permalink to this headline">¶</a></h1>
<p>Boundary is an extension of Skyline that enables very specific analysis
of specified metrics with specified algorithms, with specified alerts.</p>
<p>Boundary was added to allow for threshold-like monitoring to the Skyline
model, it was specifically added to enable the detect_drop_off_cliff
algorithm which could not be bolted nicely into Analyzer (although it
was attempted, it was ugly). While Analyzer allows for the passive
analysis of 1000s of metrics, its algorithms are not perfect. Boundary
allows for the use of the Skyline data and model as a scapel, not just a
sword. Just like Analyzer, Boundary has its own algorithms and
importantly, Boundary is <em>not</em> <code class="docutils literal"><span class="pre">CONSENSUS</span></code> based. This means that you
can match key metrics on &#8220;thresholds/limits&#8221; and somewhat dynamically
too.</p>
<p>The Boundary concept is quite like Skyline backwards, enilyks. This is
because where Analyzer is almost all to one configuration, Boundary is
more one configuration to one or many. Where Analyzer is all metrics
through all algorithms, Boundary is each metric through one algorithm.
Analyzer uses a large range of the timeseries data, Boundary uses the
most recent (the now) portion of the timeseries data.</p>
<p>Boundary currently has 3 defined algorithms:</p>
<ul class="simple">
<li>detect_drop_off_cliff</li>
<li>less_than</li>
<li>greater_than</li>
</ul>
<p>Boundary is run as a separate process just like Analyzer, horizon and
mirage. It was not envisaged to analyze all your metrics, but rather
your key metrics in an additional dimension/s. If it was run across all
of your metrics it would probably be:</p>
<ul class="simple">
<li>VERY noisy</li>
<li>CPU intensive</li>
</ul>
<p>If deployed only key metrics it has a very low footprint (9 seconds on
150 metrics with 2 processes assigned) and a high return. If deployed as
intended it should easily coexist with an existing Skyline
Analyzer/Mirage setup, with adding minimal load. This also allows one to
implement Boundary independently without changing, modifying or
impacting on a running Analyzer.</p>
<p>Boundary alerting is similar to Analyzer alerting, but a bit more
featureful and introduces the ability to rate limit alerts per alerter
channel, as it is not beyond the realms of possibility that at some
point all your key metrics may drop off a cliff, but maybe 15 pagerduty
alerts every 30 minutes is sufficient, so alert rates are configurable.</p>
<div class="section" id="configuration-and-running-boundary">
<h2>Configuration and running Boundary<a class="headerlink" href="#configuration-and-running-boundary" title="Permalink to this headline">¶</a></h2>
<p><code class="docutils literal"><span class="pre">settings.py</span></code> has an independent setting blocks and has detailed information
on each setting in its docstring, the main difference from Analyzer being in
terms of number of variables that have to be declared in the alert tuples, e.g:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="n">BOUNDARY_METRICS</span> <span class="o">=</span> <span class="p">(</span>
    <span class="c1"># (&#39;metric&#39;, &#39;algorithm&#39;, EXPIRATION_TIME, MIN_AVERAGE, MIN_AVERAGE_SECONDS, TRIGGER_VALUE, ALERT_THRESHOLD, &#39;ALERT_VIAS&#39;),</span>
    <span class="p">(</span><span class="s1">&#39;metric1&#39;</span><span class="p">,</span> <span class="s1">&#39;detect_drop_off_cliff&#39;</span><span class="p">,</span> <span class="mi">1800</span><span class="p">,</span> <span class="mi">500</span><span class="p">,</span> <span class="mi">3600</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="s1">&#39;smtp&#39;</span><span class="p">),</span>
    <span class="p">(</span><span class="s1">&#39;metric2.either&#39;</span><span class="p">,</span> <span class="s1">&#39;less_than&#39;</span><span class="p">,</span> <span class="mi">3600</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">15</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="s1">&#39;smtp|hipchat&#39;</span><span class="p">),</span>
    <span class="p">(</span><span class="s1">&#39;nometric.other&#39;</span><span class="p">,</span> <span class="s1">&#39;greater_than&#39;</span><span class="p">,</span> <span class="mi">3600</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">100000</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;smtp&#39;</span><span class="p">),</span>
<span class="p">)</span>
</pre></div>
</div>
<p>Once <code class="docutils literal"><span class="pre">settings.py</span></code> has all the Boundary configuration done, start
Boundary:</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span>/opt/skyline/github/skyline/bin/boundary.d start
</pre></div>
</div>
</div>
<div class="section" id="detect-drop-off-cliff-algorithm">
<h2>detect_drop_off_cliff algorithm<a class="headerlink" href="#detect-drop-off-cliff-algorithm" title="Permalink to this headline">¶</a></h2>
<p>The detect_drop_off_cliff algorithm provides a method for analysing a
timeseries to determine is the timeseries &#8220;dropped off a cliff&#8221;. The
standard Skyline Analyzer algorithms do not detect the drop off cliff
pattern very well at all, testing with Crucible has proven. Further to
this, the <code class="docutils literal"><span class="pre">CONSENSUS</span></code> methodology used to determine whether a
timeseries deemed anomalous or not, means that even if one or two
algorithms did detect a drop off cliff type event in a timeseries, it
would not be flagged as anomalous if the <code class="docutils literal"><span class="pre">CONSENSUS</span></code> threshold was not
breached.</p>
<p>The detect_drop_off_cliff algorithm - does just what it says on the
tin. Although this may seem like setting and matching a threshold, it is
more effective than a threshold as it is dynamically set depending on
the data range.</p>
<p>Some things to note about analyzing a timeseries with the algorithm are:</p>
<ul class="simple">
<li>This algorithm is most suited (accurate) with timeseries where there is a
large range in the timeseries most datapoints are &gt; 100 (e.g high rate).
Arbitrary <code class="docutils literal"><span class="pre">trigger</span></code> values in the algorithm do filter peaky low rate
timeseries, but they can become more noisy with lower value data points, as
significant cliff drops are from a lower height, however it still generally
matches drops off cliffs on low range metrics.</li>
<li>The trigger tuning based on the timeseries sample range is fairly arbitrary,
but has been tested and does filter peaky noise in low range timeseries, which
filters most/lots of noise.</li>
<li>The alogrithm is more suited to data sets which come from multiple sources,
e.g. an aggregation of a count from all servers, rather than from individual
sources, e.g. a single server&#8217;s metric. The many are less likely to experience
false positive cliff drops, whereas the individual is more likely to
experience true cliff drops.</li>
<li><strong>ONLY WORKS WITH</strong>:<ul>
<li>Positive, whole number timeseries data</li>
<li>Does <strong>not</strong> currently work with negative integers in the timeseries values
(although it will not break, will just skip if a negative integer is encountered)</li>
</ul>
</li>
</ul>
<p>For more info see:
<a class="reference external" href="https://github.com/earthgecko/crucible/tree/master/examples/detect_drop_off_cliff">detect_drop_off_cliff</a></p>
<div class="section" id="what-boundary-does">
<h3>What <strong>Boundary</strong> does<a class="headerlink" href="#what-boundary-does" title="Permalink to this headline">¶</a></h3>
<p>Boundary is very similar in work flow to Analyzer in terms of how it
surfaces and analyzes metrics.</p>
<ul class="simple">
<li>Boundary determines all unique metrics in Redis.</li>
<li>Boundary determines what metrics should be analyzed from the
<code class="docutils literal"><span class="pre">BOUNDARY_METRICS</span></code> tuple in <code class="docutils literal"><span class="pre">settings.py</span></code>, matching the defined
namespaces to all the unique_metrics list from Redis.</li>
<li>These are divided between the <code class="docutils literal"><span class="pre">BOUNDARY_PROCESSES</span></code> to be analyzed.</li>
<li>Boundary&#8217;s spawned processes pull the all timeseries for the metrics
they are assigned from Redis and iterate through each metric and
analyses it&#8217;s timeseries against the algorithm declared for the
metric in the matching <code class="docutils literal"><span class="pre">BOUNDARY_METRICS</span></code> tuple/s in
<code class="docutils literal"><span class="pre">settings.py</span></code></li>
<li>The Boundary process will add any metric that it finds anomalous to a
list of anomalous_metrics.</li>
<li>The parent Boundary process will then check every metric in the
anomalous_metrics list to see if:<ul>
<li>An alert has been triggered for the metric within the last
<code class="docutils literal"><span class="pre">EXPIRATION_TIME</span></code> seconds by querying the metric&#8217;s Boundary alert
key in Redis</li>
<li>If no alert key is set, send alert/s to configured alerters and sets
the metric&#8217;s Boundary alert key in for <code class="docutils literal"><span class="pre">EXPIRATION_TIME</span></code> seconds in
Redis.</li>
<li>If no alert key is set and <a class="reference internal" href="skyline.html#settings.PANORAMA_ENABLED" title="settings.PANORAMA_ENABLED"><code class="xref py py-mod docutils literal"><span class="pre">settings.PANORAMA_ENABLED</span></code></a> is <cite>True</cite>, the
anomalous metrics details will be inserted into the database.</li>
</ul>
</li>
</ul>
</div>
</div>
</div>


           </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="crucible.html" class="btn btn-neutral float-right" title="Crucible" accesskey="n">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="mirage.html" class="btn btn-neutral" title="Mirage" accesskey="p"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2013-2014, Etsy Inc; 2015, Abe Stanway; 2015-2017, Gary Wilson.

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'./',
            VERSION:'1.1.9-beta',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true
        };
    </script>
      <script type="text/javascript" src="_static/jquery.js"></script>
      <script type="text/javascript" src="_static/underscore.js"></script>
      <script type="text/javascript" src="_static/doctools.js"></script>

  

  
  
    <script type="text/javascript" src="_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>